---
- hosts: all
  tasks:
    - name: install packages
      package: name={{item}} state=latest
      with_items:
         - docker
         - vim
         - git
         - libselinux-python
      become: true
    - name: create docker group
      group: name=docker state=present
      become: true
    - name: vagrant user docker
      user: name=vagrant groups=docker
      become: true
    - name: python packages
      pip: requirements=/vagrant/requirements.txt
      become: true
    - name: docker running
      service: name=docker state=running enabled=yes
      become: true
    - name: vagrant user profile
      lineinfile: dest=/home/vagrant/.bashrc state=present line={{item}}
      with_items:
         - "export WORKON_HOME=/repos/.virtualenvs"
         - "export MSYS_HOME=/c/msys/1.0"
         - "source /usr/bin/virtualenvwrapper.sh"
    - name: id files
      copy: src=../{{item}} dest=/home/vagrant/.ssh/{{item}}
      with_items:
         - "id_rsa"
         - "id_rsa.pub"
    - name: id file permissions
      file: mode=0400 path=/home/vagrant/.ssh/{{item}} 
      with_items:
         - "id_rsa"
         - "id_rsa.pub"
    - name: git config
      lineinfile: dest=/home/vagrant/.gitconfig state=present create=yes line={{item}}
      with_items:
         - "[user]"
         - "        email = martynjamespratt@gmail.com"
         - "        name = martyni"
